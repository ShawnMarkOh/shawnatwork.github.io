<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Airport Time Zone Search</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.33/moment-timezone-with-data.min.js"></script>
  <style>
    body{background-color:#f0f0f0;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;margin:0}h1,p{font-size:24px}#search-container{text-align:center}#search-input{width:300px;padding:8px;border:1px solid #ccc;border-radius:4px}#search-results{margin-top:20px;text-align:left}.modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5)}.modal-content{background-color:#fff;border:2px solid #000;margin:15% auto;padding:20px;width:80%}.modal-close{float:right;cursor:pointer}.changelog-link{cursor:pointer;color:blue;text-decoration:underline}.weather-container{margin-top:10px}.weather-info{font-size:16px;margin-top:5px}
  </style>
</head>
<body>
  <!-- Work in Progress Modal (Displayed on Page Load) -->
  <div class="modal">
    <div class="modal-content">
      <span class="modal-close" style="float:right;cursor:pointer;">&times;</span>
      <p><b>This tool is a work in progress and does not include all airport IATA codes. If you have suggestions, please Teams me! - Shawn</b></p>
    </div>
  </div>

  <!-- Search Container -->
  <div id="search-container">
    <h1>Airport Time Zone Search</h1>
    <input type="text" id="search-input" placeholder="Enter IATA code, airport name, or city">
    <div id="search-results"></div>
  </div>

  <!-- Changelog Modal (Hidden by Default) -->
  <div class="modal">
    <div class="modal-content">
      <span class="modal-close" style="float:right;cursor:pointer;">&times;</span>
      <h2>Changelog</h2>
      <ul id="changelog-list">
        <li>2023-07-27: Added functionality to search by partial airport names (e.g., "Tyson" for "McGhee Tyson Airport").</li>
        <li>2023-07-27: Modified search to prioritize IATA codes over city names.</li>
        <li>2023-07-27: Added IATA code display in search results.</li>
        <li>2023-07-25: Added 400+ new airports in United States, Canada, and The Bahamas.</li>
        <li>2023-07-24: Initial version of the Airport Time Zone Search tool.</li>
      </ul>
    </div>
  </div>

  <!-- Changelog Link -->
  <div class="changelog-link">Changelog</div>

<script>
  const airports = [
    {"iataCode": "ABE", "name": "Lehigh Valley International Airport", "city": "Allentown", "state": "Pennsylvania", "timeZone": "America/New_York", "latitude": 40.65236, "longitude": -75.44040},
    {"iataCode": "ABI", "name": "Abilene Regional Airport", "city": "Abilene", "state": "Texas", "timeZone": "America/Chicago", "latitude": 32.41132, "longitude": -99.68190},
    {"iataCode": "ABQ", "name": "Albuquerque International Sunport", "city": "Albuquerque", "state": "New Mexico", "timeZone": "America/Denver", "latitude": 35.04022, "longitude": -106.60919},
    // Add more airports here if needed
  ];

  let currentAirportCode = null;

  async function fetchWeatherForecast(foundAirport) {
    try {
      const pointsResponse = await fetch(`https://api.weather.gov/points/${foundAirport.latitude},${foundAirport.longitude}`);
      const pointsData = await pointsResponse.json();
      const forecastURL = pointsData.properties.forecast;

      if (!forecastURL) {
        throw new Error("Forecast URL not found.");
      }

      const forecastResponse = await fetch(forecastURL);
      const forecastData = await forecastResponse.json();

      const today = new Date();
      const periodsToday = forecastData.properties.periods.filter(period => {
        const periodStartTime = new Date(period.startTime);
        return periodStartTime.getDate() === today.getDate() &&
          periodStartTime.getMonth() === today.getMonth() &&
          periodStartTime.getFullYear() === today.getFullYear();
      });

      let forecastHTML = '<h3>Weather Forecast</h3>';
      for (const period of periodsToday) {
        forecastHTML += `<p><strong>${period.name}:</strong> ${period.shortForecast}, ${period.temperature}&deg; ${period.temperatureUnit}</p>`;
      }

      // Update the weather forecast section with the new data
      document.getElementById('weather-forecast').innerHTML = forecastHTML;

    } catch (error) {
      console.error("Error fetching weather forecast:", error);
    }
  }

  function updateAirportTime(foundAirport) {
    const currentTime = moment.tz(foundAirport.timeZone).format("YYYY-MM-DD HH:mm:ss z");
    document.getElementById(`current-time-${foundAirport.iataCode}`).textContent = currentTime;
  }

  async function searchAirport() {
    const searchInput = document.getElementById("search-input").value.trim().toUpperCase();
    const searchResultsDiv = document.getElementById("search-results");

    if (searchInput === "") {
      searchResultsDiv.innerHTML = "";
      currentAirportCode = null;
      return;
    }

    let foundAirport = airports.find(airport => airport.iataCode === searchInput);

    if (!foundAirport) {
      foundAirport = airports.find(airport => airport.name.toUpperCase().includes(searchInput));

      if (!foundAirport) {
        foundAirport = airports.find(airport => airport.city.toUpperCase().startsWith(searchInput));
      }
    }

    if (foundAirport) {
      // Check if the found airport is different from the current airport
      if (currentAirportCode !== foundAirport.iataCode) {
        currentAirportCode = foundAirport.iataCode;

        const currentTime = moment.tz(foundAirport.timeZone).format("YYYY-MM-DD HH:mm:ss z");
        let locationInfo = `<p><strong>IATA Code:</strong> ${foundAirport.iataCode}</p>`;
        locationInfo += `<p><strong>Airport:</strong> ${foundAirport.name}</p>`;
        if (foundAirport.city) {
          locationInfo += `<p><strong>City:</strong> ${foundAirport.city}</p>`;
        }
        if (foundAirport.state) {
          locationInfo += `<p><strong>State:</strong> ${foundAirport.state}</p>`;
        }
        locationInfo += `<p><strong>Time Zone:</strong> <span id="current-time-${foundAirport.iataCode}">${currentTime}</span></p>`;

        // Display both the airport information and weather forecast
        searchResultsDiv.innerHTML = locationInfo + '<div id="weather-forecast"></div>';

        // Fetch and display the weather forecast after showing the airport information
        fetchWeatherForecast(foundAirport);

        // Set interval to update the current time every minute
        setInterval(() => updateAirportTime(foundAirport), 60000);
      }
    } else {
      searchResultsDiv.innerHTML = `<p>No airport found for "${searchInput}".</p>`;
      currentAirportCode = null;
    }
  }

  document.getElementById("search-input").addEventListener("input", searchAirport);

  // Initialization
  document.getElementById("search-input").value = "";
  document.getElementById("search-results").innerHTML = "";

  // Display the modal
  const modal = document.querySelector('.modal');
  window.onload = function() {
    modal.style.display = "block";
  }

  // Hide the modal when user clicks on (x)
  const close = document.querySelector('.modal-close');
  close.onclick = function() {
    modal.style.display = "none";
  }

  // Hide the modal when user clicks anywhere outside of the modal
  window.onclick = function(event) {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }

  // Changelog modal logic
  const changelogModal = document.querySelector('.modal');
  const changelogLink = document.querySelector('.changelog-link');
  changelogLink.onclick = function() {
    changelogModal.style.display = "block";
  }
</script>






</body>
</html>

